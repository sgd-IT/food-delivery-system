# 表单页面后端联调测试清单

## 已修复的问题

### 1. 图片上传响应格式修复 ✅
- **问题**：之前使用 `response.data.url`，但后端返回的是 `{code: 1, data: "文件路径字符串"}`
- **修复**：改为 `response.data`（直接是文件路径字符串）
- **影响文件**：
  - `src/views/dish/addDishtype.vue`
  - `src/views/setmeal/addSetmeal.vue`

### 2. 上传接口路径 ✅
- **路径**：`${VITE_API_URL}/api/common/upload`
- **后端接口**：`/admin/common/upload`（通过代理 `/api` 前缀访问）
- **认证方式**：使用 `token` 字段（不是 `Authorization`）

## 测试检查项

### 菜品添加/编辑表单 (`/dish/add`)

#### 1. 基础功能测试
- [ ] 页面正常加载
- [ ] 菜品分类下拉列表正常加载
- [ ] 表单验证规则生效（名称、分类、价格、商品码、图片）

#### 2. 图片上传测试
- [ ] 点击上传按钮，选择图片
- [ ] 图片大小限制（2MB）生效
- [ ] 图片格式限制（PNG/JPEG/JPG）生效
- [ ] 上传成功后，图片预览正常显示
- [ ] 上传失败时，错误提示正常

#### 3. 口味配置测试
- [ ] 添加口味功能正常
- [ ] 选择口味下拉框正常显示
- [ ] 删除口味功能正常
- [ ] 口味标签显示正常

#### 4. API 调用测试
- [ ] 新增菜品：提交后调用 `/dish` POST 接口
- [ ] 编辑菜品：加载时调用 `/dish/{id}` GET 接口
- [ ] 编辑菜品：提交后调用 `/dish` PUT 接口
- [ ] 参数格式正确：
  - `name`: 字符串
  - `categoryId`: 字符串
  - `price`: 字符串（数字格式）
  - `code`: 字符串
  - `image`: 字符串（文件路径）
  - `description`: 字符串
  - `status`: 数字（0停售/1启售）
  - `flavors`: 数组，每个元素包含 `{name: string, value: string}`（value是JSON字符串）

#### 5. 响应处理测试
- [ ] 成功响应：`{code: 1, data: {...}, msg: null}`
- [ ] 错误响应：`{code: 0, data: null, msg: "错误信息"}`
- [ ] 成功提示正常显示
- [ ] 错误提示正常显示

### 员工添加/编辑表单 (`/employee/add`)

#### 1. 基础功能测试
- [ ] 页面正常加载
- [ ] 表单验证规则生效（账号、姓名、手机号、身份证号）

#### 2. API 调用测试
- [ ] 新增员工：提交后调用 `/employee` POST 接口
- [ ] 编辑员工：加载时调用 `/employee/{id}` GET 接口
- [ ] 编辑员工：提交后调用 `/employee` PUT 接口
- [ ] 参数格式正确：
  - `username`: 字符串
  - `name`: 字符串
  - `phone`: 字符串
  - `sex`: 字符串（"0"女/"1"男）
  - `idNumber`: 字符串

#### 3. 响应处理测试
- [ ] 成功响应处理正常
- [ ] 错误响应处理正常

### 套餐添加/编辑表单 (`/setmeal/add`)

#### 1. 基础功能测试
- [ ] 页面正常加载
- [ ] 套餐分类下拉列表正常加载
- [ ] 表单验证规则生效

#### 2. 图片上传测试
- [ ] 同菜品表单的图片上传测试项

#### 3. 菜品选择测试
- [ ] 打开添加菜品弹窗
- [ ] 分类切换正常
- [ ] 搜索菜品功能正常
- [ ] 选择菜品后，已选列表正常显示
- [ ] 删除已选菜品功能正常
- [ ] 设置菜品份数功能正常

#### 4. API 调用测试
- [ ] 新增套餐：提交后调用 `/setmeal` POST 接口
- [ ] 编辑套餐：加载时调用 `/setmeal/{id}` GET 接口
- [ ] 编辑套餐：提交后调用 `/setmeal` PUT 接口
- [ ] 参数格式正确：
  - `name`: 字符串
  - `categoryId`: 字符串
  - `price`: 字符串（数字格式）
  - `image`: 字符串（文件路径）
  - `description`: 字符串
  - `status`: 数字（0停售/1启售）
  - `setmealDishes`: 数组，每个元素包含 `{copies: number, dishId: string, name: string, price: number}`

#### 5. 响应处理测试
- [ ] 成功响应处理正常
- [ ] 错误响应处理正常

## 常见问题排查

### 1. 图片上传失败
- 检查上传接口路径是否正确：`/api/common/upload`
- 检查请求头是否包含 `token` 字段
- 检查后端接口是否正常（`/admin/common/upload`）
- 检查响应格式：`{code: 1, data: "文件路径"}`

### 2. API 调用失败
- 检查请求路径是否正确（是否包含 `/api` 前缀）
- 检查请求头是否包含 `token` 字段
- 检查请求参数格式是否正确
- 检查响应拦截器是否正确处理 `code=1` 的成功响应

### 3. 表单验证失败
- 检查验证规则是否正确
- 检查必填字段是否都已填写
- 检查格式验证（手机号、身份证号等）是否正确

### 4. 数据加载失败
- 检查分类列表接口是否正常
- 检查编辑时数据加载接口是否正常
- 检查响应数据格式是否正确

## 测试环境配置

### 环境变量
- `VITE_API_URL`: 后端API基础URL（例如：`http://localhost:8080`）

### 认证Token
- 确保已登录，token 已存储在 userStore 中
- Token 通过请求头 `token` 字段传递

## 测试步骤

1. **启动后端服务**
   ```bash
   # 确保后端服务运行在 http://localhost:8080
   ```

2. **启动前端服务**
   ```bash
   cd art-design-pro-main
   npm install
   npm run dev
   ```

3. **登录系统**
   - 使用默认账号：`admin/123456`
   - 确保登录成功，token 已保存

4. **测试表单页面**
   - 依次测试三个表单页面的所有功能
   - 记录测试结果
   - 如有问题，参考"常见问题排查"部分

## 注意事项

1. **响应格式**：后端统一返回 `{code: 1, data: {...}, msg: null}` 格式
2. **HTTP拦截器**：已自动处理响应，API调用直接返回 `data` 部分
3. **文件上传**：ElUpload 组件直接使用 XMLHttpRequest，响应格式为后端原始格式
4. **参数序列化**：POST/PUT 请求自动序列化为 JSON
5. **GET请求**：参数自动序列化到 URL

