# 云味道外卖系统 - 技术架构图

## 系统分层架构图

```mermaid
flowchart TB
    subgraph UI["前端UI层"]
        direction LR
        UI1[Vue 3]
        UI2[Element Plus]
        UI3[uni-app]
    end
    
    subgraph PRES["展示层"]
        direction LR
        P1[Vue Router]
        P2[Axios交互]
        P3[Pinia]
        P4[模板]
    end
    
    subgraph BUS["业务层"]
        direction LR
        B1[订单管理]
        B2[菜品管理]
        B3[用户管理]
        B4[分类管理]
        B5[套餐管理]
        B6[统计分析]
        B7[支付处理]
    end
    
    subgraph DATA["数据层"]
        direction LR
        D1[MyBatis]
        D2[缓存]
        D3[连接池]
        D4[事务]
        D5[数据校验]
    end
    
    subgraph DB["数据库"]
        direction LR
        DB1[MySQL]
        DB2[Redis]
    end
    
    subgraph LOG["日志记录"]
        direction TB
        LOG1[SLF4J]
        LOG2[Logback]
    end
    
    subgraph CTRL["控制"]
        direction TB
        CTRL1[JWT认证]
        CTRL2[权限控制]
        CTRL3[异常处理]
        CTRL4[跨域配置]
    end
    
    subgraph FRAME["后端框架"]
        direction TB
        FRAME1[Spring Boot]
        FRAME2[Spring MVC]
        FRAME3[Spring Security]
        FRAME4[MyBatis]
    end
    
    UI --> PRES
    PRES --> BUS
    BUS --> DATA
    DATA --> DB
    
    LOG -.-> BUS
    LOG -.-> DATA
    
    CTRL -.-> PRES
    CTRL -.-> BUS
    
    FRAME -.-> BUS
    FRAME -.-> DATA
    
    classDef layerBox fill:#ffffff,stroke:#000000,stroke-width:2px
    classDef itemBox fill:#f5f5f5,stroke:#666666,stroke-width:1px
    
    class UI,PRES,BUS,DATA,DB layerBox
    class UI1,UI2,UI3,P1,P2,P3,P4,B1,B2,B3,B4,B5,B6,B7,D1,D2,D3,D4,D5,DB1,DB2 itemBox
    class LOG,CTRL,FRAME layerBox
    class LOG1,LOG2,CTRL1,CTRL2,CTRL3,CTRL4,FRAME1,FRAME2,FRAME3,FRAME4 itemBox
```

### 架构说明

**分层结构（从上到下）：**

1. **前端UI层**：用户界面展示
   - Vue 3 + TypeScript：核心前端框架
   - Element Plus：管理后台UI组件库
   - uni-app：微信小程序框架
   - HTML/CSS：页面结构和样式

2. **展示层**：前端交互和状态管理
   - Vue Router：路由管理
   - Axios：HTTP请求和Ajax交互
   - Pinia：全局状态管理
   - 模板渲染：页面模板处理

3. **业务层**：核心业务逻辑处理
   - 订单管理：订单创建、查询、状态管理
   - 菜品管理：菜品CRUD、口味管理
   - 用户管理：用户注册、登录、信息管理
   - 分类管理：菜品和套餐分类
   - 套餐管理：套餐CRUD、套餐菜品关联
   - 统计分析：数据统计、报表生成
   - 支付处理：微信支付集成、支付回调

4. **数据层**：数据访问和缓存
   - MyBatis Mapper：SQL映射和数据访问
   - Redis缓存：热点数据缓存、会话存储
   - Druid连接池：数据库连接管理
   - 事务管理：数据一致性保证
   - 数据校验：参数校验、数据验证

5. **数据库层**：数据持久化存储
   - MySQL 8.0：主数据库，存储业务数据
   - Redis：缓存数据库，提升性能

**横切关注点（右侧垂直面板）：**

- **日志记录**：系统日志记录和追踪
  - SLF4J：日志门面
  - Logback：日志实现

- **控制**：系统控制和安全管理
  - JWT认证：Token身份验证
  - 权限控制：接口权限管理
  - 异常处理：全局异常捕获
  - 跨域配置：CORS跨域支持

- **后端框架**：核心技术框架
  - Spring Boot 2.7.3：应用框架
  - Spring MVC：Web框架
  - Spring Security：安全框架
  - MyBatis 2.2.0：ORM框架

## 详细技术架构

### 1. 前端管理端架构

```mermaid
graph LR
    subgraph "前端管理端 - Vue 3 技术栈"
        A1[Vue 3.5<br/>核心框架]
        A2[TypeScript<br/>类型系统]
        A3[Vite 7<br/>构建工具]
        A4[Element Plus<br/>UI组件库]
        A5[Pinia<br/>状态管理]
        A6[Vue Router 4<br/>路由管理]
        A7[Axios<br/>HTTP客户端]
        A8[ECharts<br/>数据可视化]
        A9[TailwindCSS<br/>样式框架]
    end
    
    A1 --> A2
    A1 --> A3
    A1 --> A4
    A1 --> A5
    A1 --> A6
    A3 --> A7
    A1 --> A8
    A3 --> A9
    
    style A1 fill:#42b983
    style A3 fill:#646cff
    style A4 fill:#409eff
```

**技术栈详情：**
- **核心框架**：Vue 3.5.21 + Composition API
- **类型系统**：TypeScript 5.6.3
- **构建工具**：Vite 7.1.5
- **UI框架**：Element Plus 2.11.2
- **状态管理**：Pinia 3.0.3 + 持久化插件
- **路由管理**：Vue Router 4.5.1
- **HTTP客户端**：Axios 1.12.2
- **数据可视化**：ECharts 6.0.0
- **样式方案**：TailwindCSS 4.1.14 + SCSS
- **国际化**：Vue I18n 9.14.0
- **其他工具**：文件上传、Excel导出、二维码生成等

### 2. 后端服务架构

```mermaid
graph TB
    subgraph "后端服务层 - Spring Boot 技术栈"
        B1[Spring Boot 2.7.3<br/>应用框架]
        B2[Spring MVC<br/>Web层]
        B3[Spring Cache<br/>缓存抽象]
        B4[Spring WebSocket<br/>实时通信]
        B5[MyBatis 2.2.0<br/>持久层框架]
        B6[Druid 1.2.1<br/>连接池]
        B7[JWT<br/>身份认证]
        B8[Knife4j 3.0.2<br/>API文档]
        B9[全局异常处理<br/>统一异常]
        B10[拦截器<br/>权限控制]
    end
    
    B1 --> B2
    B1 --> B3
    B1 --> B4
    B2 --> B5
    B5 --> B6
    B2 --> B7
    B2 --> B8
    B2 --> B9
    B2 --> B10
    
    style B1 fill:#6db33f
    style B5 fill:#d81e06
```

**技术栈详情：**
- **核心框架**：Spring Boot 2.7.3
- **Web框架**：Spring MVC
- **持久层**：MyBatis 2.2.0 + PageHelper分页
- **数据库连接池**：Druid 1.2.1（支持监控）
- **缓存**：Spring Cache + Redis
- **实时通信**：Spring WebSocket
- **身份认证**：JWT (jjwt 0.9.1)
- **API文档**：Knife4j 3.0.2 (Swagger增强版)
- **工具类**：Lombok、FastJSON、Apache POI
- **AOP**：AspectJ（自动填充创建人/修改人）

### 3. 微信小程序架构

```mermaid
graph LR
    subgraph "微信小程序 - uni-app技术栈"
        C1[uni-app<br/>跨平台框架]
        C2[微信小程序API<br/>原生能力]
        C3[uni-ui组件库<br/>UI组件]
    end
    
    C1 --> C2
    C1 --> C3
    
    style C1 fill:#07c160
```

**技术栈详情：**
- **框架**：uni-app
- **平台**：微信小程序
- **UI组件**：uni-ui组件库
- **功能模块**：首页、商品详情、购物车、订单、地址管理、个人中心等

### 4. 数据层架构

```mermaid
graph TB
    subgraph "数据持久层"
        D1[MySQL 8.0<br/>主数据库]
        D2[MyBatis Mapper<br/>SQL映射]
        D3[Druid连接池<br/>连接管理]
        D4[Redis<br/>缓存数据库]
    end
    
    D2 --> D3
    D3 --> D1
    D4 -.缓存.-> D1
    
    style D1 fill:#4479a1
    style D4 fill:#dc382d
```

**数据库设计：**
- **主数据库**：MySQL 8.0
- **缓存数据库**：Redis
- **核心表结构**：
  - 员工表（EMPLOYEE）
  - 用户表（USER）
  - 分类表（CATEGORY）
  - 菜品表（DISH）
  - 菜品口味表（DISH_FLAVOR）
  - 套餐表（SETMEAL）
  - 套餐菜品关联表（SETMEAL_DISH）
  - 购物车表（SHOPPING_CART）
  - 订单表（ORDERS）
  - 订单明细表（ORDER_DETAIL）
  - 地址簿表（ADDRESS_BOOK）

### 5. 项目模块结构

```mermaid
graph TB
    subgraph "Maven多模块项目"
        E1[food-delivery-system<br/>父模块]
        E2[fooddelivery-common<br/>公共模块]
        E3[fooddelivery-pojo<br/>实体类模块]
        E4[fooddelivery-server<br/>服务端模块]
    end
    
    E1 --> E2
    E1 --> E3
    E1 --> E4
    E4 --> E2
    E4 --> E3
    
    style E1 fill:#c71a36
    style E4 fill:#6db33f
```

**模块说明：**
- **food-delivery-system**：父模块，统一管理依赖版本
- **fooddelivery-common**：公共工具类、常量、异常等
- **fooddelivery-pojo**：实体类、DTO、VO等数据传输对象
- **fooddelivery-server**：服务端主模块，包含Controller、Service、Mapper等

### 6. 系统分层架构

```mermaid
graph TB
    subgraph "表现层"
        F1[Controller层<br/>接收请求/返回响应]
    end
    
    subgraph "业务层"
        F2[Service接口层<br/>业务接口定义]
        F3[Service实现层<br/>业务逻辑实现]
    end
    
    subgraph "持久层"
        F4[Mapper接口层<br/>数据访问接口]
        F5[Mapper XML层<br/>SQL映射文件]
    end
    
    subgraph "数据层"
        F6[MySQL数据库<br/>数据存储]
    end
    
    F1 --> F2
    F2 --> F3
    F3 --> F4
    F4 --> F5
    F5 --> F6
    
    style F1 fill:#e1f5ff
    style F3 fill:#fff4e1
    style F5 fill:#ffe1f5
    style F6 fill:#e1ffe1
```

**分层说明：**
- **Controller层**：处理HTTP请求，参数校验，调用Service
- **Service层**：业务逻辑处理，事务管理
- **Mapper层**：数据访问，SQL执行
- **Entity层**：实体类，对应数据库表

### 7. 安全与认证架构

```mermaid
graph LR
    subgraph "认证授权流程"
        G1[用户登录]
        G2[JWT Token生成]
        G3[Token验证拦截器]
        G4[权限校验]
        G5[业务处理]
    end
    
    G1 --> G2
    G2 --> G3
    G3 --> G4
    G4 --> G5
    
    style G2 fill:#ff9800
    style G3 fill:#f44336
```

**安全机制：**
- **JWT认证**：管理员和用户分别使用不同的Token
- **拦截器**：
  - `JwtTokenAdminInterceptor`：管理员接口拦截
  - `JwtTokenUserInterceptor`：用户接口拦截
- **跨域配置**：CORS支持
- **密码加密**：MD5加密存储

### 8. 实时通信架构

```mermaid
graph TB
    subgraph "WebSocket实时通信"
        H1[WebSocket Server<br/>服务端]
        H2[WebSocket Client<br/>客户端]
        H3[订单状态推送]
        H4[消息广播]
    end
    
    H1 <--> H2
    H1 --> H3
    H1 --> H4
    
    style H1 fill:#9c27b0
    style H2 fill:#673ab7
```

**实时通信功能：**
- **订单状态推送**：订单状态变更实时通知
- **消息广播**：系统消息推送
- **定时任务**：订单超时处理等

### 9. 外部服务集成

```mermaid
graph LR
    subgraph "外部服务"
        I1[微信支付<br/>支付接口]
        I2[微信开放平台<br/>用户授权]
        I3[阿里云OSS<br/>文件存储]
    end
    
    subgraph "后端服务"
        I4[支付回调处理]
        I5[用户登录授权]
        I6[文件上传下载]
    end
    
    I4 --> I1
    I5 --> I2
    I6 --> I3
    
    style I1 fill:#07c160
    style I2 fill:#07c160
    style I3 fill:#ff6900
```

**外部服务：**
- **微信支付**：订单支付、支付回调处理
- **微信开放平台**：小程序用户授权登录
- **阿里云OSS**：图片、文件存储（可选）

## 技术选型总结

### 前端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.5.21 | 核心框架 |
| TypeScript | 5.6.3 | 类型系统 |
| Vite | 7.1.5 | 构建工具 |
| Element Plus | 2.11.2 | UI组件库 |
| Pinia | 3.0.3 | 状态管理 |
| Vue Router | 4.5.1 | 路由管理 |
| Axios | 1.12.2 | HTTP客户端 |
| ECharts | 6.0.0 | 数据可视化 |

### 后端技术栈
| 技术 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 2.7.3 | 应用框架 |
| MyBatis | 2.2.0 | ORM框架 |
| MySQL | 8.0 | 关系型数据库 |
| Redis | - | 缓存数据库 |
| Druid | 1.2.1 | 数据库连接池 |
| JWT | 0.9.1 | 身份认证 |
| Knife4j | 3.0.2 | API文档 |
| WebSocket | - | 实时通信 |

### 开发工具
| 工具 | 用途 |
|------|------|
| Maven | 项目构建和依赖管理 |
| Git | 版本控制 |
| IDE | IntelliJ IDEA / VS Code |
| Postman | API测试 |
| Navicat | 数据库管理 |

## 部署架构

```mermaid
graph TB
    subgraph "生产环境部署"
        J1[Nginx<br/>反向代理/静态资源]
        J2[Spring Boot应用<br/>JAR包部署]
        J3[MySQL数据库<br/>主从复制]
        J4[Redis集群<br/>缓存集群]
    end
    
    J1 --> J2
    J2 --> J3
    J2 --> J4
    
    style J1 fill:#009639
    style J2 fill:#6db33f
    style J3 fill:#4479a1
    style J4 fill:#dc382d
```

**部署说明：**
- **前端**：Nginx部署静态资源，支持反向代理
- **后端**：Spring Boot打包成JAR，使用内嵌Tomcat
- **数据库**：MySQL主从复制，保证高可用
- **缓存**：Redis集群，提升性能

## 系统特点

1. **前后端分离**：Vue 3 + Spring Boot，职责清晰
2. **多端支持**：管理后台 + 微信小程序
3. **模块化设计**：Maven多模块，便于维护
4. **安全可靠**：JWT认证 + 权限控制
5. **高性能**：Redis缓存 + 连接池优化
6. **实时通信**：WebSocket支持订单状态推送
7. **完善的文档**：Knife4j自动生成API文档
8. **易于扩展**：分层架构，便于功能扩展

